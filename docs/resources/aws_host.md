---

# Resource: duplocloud_aws_host



The duplocloud_aws_host represents an AWS resource, such as an EC2 instance, that is managed and automated through DuploCloud. It provides seamless integration and governance within AWS, enabling efficient deployment, management, and scaling of cloud infrastructure through DuploCloudâ€™s platform.


## Example Usage

### Deploy a host which will be used for DuploCloud platform's native container agent to deploy native containers

```terraform
# Before creating a host, you must first set up the infrastructure without an eks cluster. Then, you must create a tenant inside the infra. Below is the resource for creating the infrastructure.
resource "duplocloud_infrastructure" "infra" {
  infra_name        = "dev"
  cloud             = 0 # AWS Cloud
  region            = "us-east-1"
  enable_k8_cluster = false
  address_prefix    = "10.13.0.0/16"
}

# Use the infrastructure name as the 'plan_id' from the 'duplocloud_infrastructure' resource while creating tenant.
resource "duplocloud_tenant" "tenant" {
  account_name = "dev"
  plan_id      = duplocloud_infrastructure.infra.infra_name
}

# Create a data source to retrieve the Machine Image ID to be used by the host
data "duplocloud_native_host_image" "image" {
  tenant_id     = duplocloud_tenant.tenant.tenant_id
  is_kubernetes = false  # for native container agent
}

resource "duplocloud_aws_host" "native" {
  tenant_id     = duplocloud_tenant.tenant.tenant_id
  friendly_name = "host01"

  image_id       = data.duplocloud_native_host_image.image.image_id # get the image_id from the data source
  capacity       = "t3a.medium"
  agent_platform = 0 # Duplo native container agent
  zone           = 0 # Zone A
  user_account   = duplocloud_tenant.tenant.account_name

  metadata {
    key   = "OsDiskSize" # <== This is the size of the OS disk in GB
    value = "20"
  }
}
```

### Create an EKS worker node for deployment of the Kubernetes applications 

```terraform
# Before creating the EKS worker node, you must first set up the infrastructure with EKS cluster enabled and a tenant. Below is the resource for creating the infrastructure.
resource "duplocloud_infrastructure" "infra" {
  infra_name        = "dev"
  cloud             = 0 # AWS Cloud
  region            = "us-east-1"
  enable_k8_cluster = true
  address_prefix    = "10.13.0.0/16"
}

# Use the infrastructure name as the 'plan_id' from the 'duplocloud_infrastructure' resource while creating tenant.
resource "duplocloud_tenant" "tenant" {
  account_name = "dev"
  plan_id      = duplocloud_infrastructure.infra.infra_name
}

# Create a data source to retrieve the Machine Image ID to be used by the host
data "duplocloud_native_host_image" "image" {
  tenant_id     = duplocloud_tenant.tenant.tenant_id
  is_kubernetes = true # for EKS agent
}

resource "duplocloud_aws_host" "host" {
  tenant_id     = duplocloud_tenant.tenant.tenant_id
  friendly_name = "host02"

  image_id       = data.duplocloud_native_host_image.image.image_id # get the image_id from the data source
  capacity       = "t3a.small"
  agent_platform = 7 # Duplo EKS container agent
  zone           = 0 # Zone A
  user_account   = duplocloud_tenant.tenant.account_name
  keypair_type   = 1
}
```

### Create an EKS worker node inside the 'dev' tenant for deployment of the Kubernetes applications, with instance metadata service

```terraform
# Ensure the 'dev' tenant is already created before setting up the EKS worker node.
data "duplocloud_tenant" "tenant" {
  name = "dev"
}

data "duplocloud_native_host_image" "image" {
  tenant_id     = data.duplocloud_tenant.tenant.id
  is_kubernetes = true # for EKS agent
}

resource "duplocloud_aws_host" "host" {
  tenant_id     = data.duplocloud_tenant.tenant.id
  friendly_name = "host03"

  image_id       = data.duplocloud_native_host_image.image.image_id # get the image id from the data source
  capacity       = "t3.small"
  agent_platform = 7 # Duplo EKS agent
  zone           = 0 # Zone A
  user_account   = data.duplocloud_tenant.tenant.name
  keypair_type   = "1"

  metadata {
    key   = "OsDiskSize" # <== This is the size of the OS disk in GB
    value = "20"
  }

  # Create a host with instance metadata v2 only
  metadata {
    key   = "MetadataServiceOption"
    value = "enabled_v2_only"
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `capacity` (String) The AWS EC2 instance type.
- `friendly_name` (String) The short name of the host.
- `image_id` (String) The AMI ID to use.
- `tenant_id` (String) The GUID of the tenant that the host will be created in.

### Optional

- `agent_platform` (Number) The numeric ID of the container agent pool that this host is added to. Defaults to `0`.
- `allocated_public_ip` (Boolean) Whether or not to allocate a public IP. Defaults to `false`.
- `base64_user_data` (String) Base64 encoded EC2 user data to associated with the host.
- `cloud` (Number) The numeric ID of the cloud provider to launch the host in. Defaults to `0`.
- `custom_node_labels` (Map of String) Specify the labels to attach to the nodes.
- `encrypt_disk` (Boolean) Defaults to `false`.
- `is_ebs_optimized` (Boolean) Defaults to `false`.
- `is_minion` (Boolean) Defaults to `true`.
- `keypair_type` (Number) The numeric ID of the keypair type being used.Should be one of:

   - `0` : Default
   - `1` : ED25519
   - `2` : RSA (deprecated - some operating systems no longer support it)
- `metadata` (Block List) Configuration metadata used when creating the host.<br>*Note: To configure OS disk size OsDiskSize can be specified as Key and its size as value, size value should be atleast 10* (see [below for nested schema](#nestedblock--metadata))
- `minion_tags` (Block List) A map of tags to assign to the resource. Example - `AllocationTags` can be passed as tag key with any value. (see [below for nested schema](#nestedblock--minion_tags))
- `network_interface` (Block List) An optional list of custom network interface configurations to use when creating the host. (see [below for nested schema](#nestedblock--network_interface))
- `prepend_user_data` (Boolean) Bootstrap an EKS host with Duplo's user data, prepending it to custom user data if also provided. Defaults to `true`.
- `tags` (Block List) (see [below for nested schema](#nestedblock--tags))
- `taints` (Block List) Specify taints to attach to the nodes, to repel other nodes with different toleration (see [below for nested schema](#nestedblock--taints))
- `timeouts` (Block, Optional) (see [below for nested schema](#nestedblock--timeouts))
- `user_account` (String) The name of the tenant that the host will be created in.
- `volume` (Block List) Block to specify additional or secondary volume beyond the root device (see [below for nested schema](#nestedblock--volume))
- `wait_until_connected` (Boolean) Whether or not to wait until Duplo can connect to the host, after creation. Defaults to `true`.
- `zone` (Number) The availability zone to launch the host in, expressed as a number and starting at 0. Defaults to `0`.

### Read-Only

- `id` (String) The ID of this resource.
- `identity_role` (String) The name of the IAM role associated with this host.
- `initial_base64_user_data` (String)
- `instance_id` (String) The AWS EC2 instance ID of the host.
- `private_ip_address` (String) The primary private IP address assigned to the host.
- `public_ip_address` (String) The primary public IP address assigned to the host.
- `status` (String) The current status of the host.

<a id="nestedblock--metadata"></a>
### Nested Schema for `metadata`

Required:

- `key` (String)
- `value` (String)


<a id="nestedblock--minion_tags"></a>
### Nested Schema for `minion_tags`

Required:

- `key` (String)
- `value` (String)


<a id="nestedblock--network_interface"></a>
### Nested Schema for `network_interface`

Optional:

- `associate_public_ip` (Boolean) Whether or not to associate a public IP with the newly created ENI.  Cannot be specified if `network_interface_id` is specified.
- `device_index` (Number) The device index to pass to AWS for attaching the ENI.  Starts at zero.
- `groups` (List of String)
- `metadata` (Block List) (see [below for nested schema](#nestedblock--network_interface--metadata))
- `network_interface_id` (String) The ID of an ENI to attach to this host.  Cannot be specified if `subnet_id` or `associate_public_ip` is specified.
- `subnet_id` (String) The ID of a subnet in which to create a new ENI.  Cannot be specified if `network_interface_id` is specified.

<a id="nestedblock--network_interface--metadata"></a>
### Nested Schema for `network_interface.metadata`

Required:

- `key` (String)
- `value` (String)



<a id="nestedblock--tags"></a>
### Nested Schema for `tags`

Required:

- `key` (String)
- `value` (String)


<a id="nestedblock--taints"></a>
### Nested Schema for `taints`

Required:

- `effect` (String) Update strategy of the node. Effect types <br>      - NoSchedule<br>     - PreferNoSchedule<br>     - NoExecute
- `key` (String)
- `value` (String)


<a id="nestedblock--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String)
- `delete` (String)
- `update` (String)


<a id="nestedblock--volume"></a>
### Nested Schema for `volume`

Optional:

- `iops` (Number)
- `name` (String)
- `size` (Number)
- `volume_id` (String)
- `volume_type` (String)

## Import

Import is supported using the following syntax:

```shell
# Example: Importing an existing AWS host
#  - *TENANT_ID* is the tenant GUID
#  - *INSTANCE_ID* is the AWS EC2 instance ID
#
terraform import duplocloud_aws_host.myhost v2/subscriptions/*TENANT_ID*/NativeHostV2/*INSTANCE_ID*
```
