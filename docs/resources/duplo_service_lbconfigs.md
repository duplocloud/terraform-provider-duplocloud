---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "duplocloud_duplo_service_lbconfigs Resource - terraform-provider-duplocloud"
subcategory: ""
description: |-
  duplocloud_duplo_service_lbconfigs manages load balancer configuration(s) for a container-based service in Duplo.
  NOTE: For Amazon ECS services, see the duplocloud_ecs_service resource.
---

# duplocloud_duplo_service_lbconfigs (Resource)

`duplocloud_duplo_service_lbconfigs` manages load balancer configuration(s) for a container-based service in Duplo.

NOTE: For Amazon ECS services, see the `duplocloud_ecs_service` resource.

## Example Usage

```terraform
resource "duplocloud_tenant" "myapp" {
  account_name = "myapp"
  plan_id      = "default"
}

# Deploy NGINX using Duplo's native container agent, and configure a load balancer.
resource "duplocloud_duplo_service" "myservice" {
  tenant_id = duplocloud_tenant.myapp.tenant_id

  name           = "myservice"
  agent_platform = 0 # Duplo native container agent
  docker_image   = "nginx:latest"
  replicas       = 1
}
resource "duplocloud_duplo_service_lbconfigs" "myservice" {
  tenant_id                   = duplocloud_duplo_service.myservice.tenant_id
  replication_controller_name = duplocloud_duplo_service.myservice.name

  lbconfigs {
    external_port    = 80
    health_check_url = "/"
    is_native        = false
    lb_type          = 1 # Application load balancer
    port             = "80"
    protocol         = "http"

    health_check {
      healthy_threshold   = 4
      unhealthy_threshold = 4
      timeout             = 50
      interval            = 30
      http_success_codes  = "200-399"
    }
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `lbconfigs` (Block List, Min: 1) (see [below for nested schema](#nestedblock--lbconfigs))
- `replication_controller_name` (String) The name of the duplo service.
- `tenant_id` (String) The GUID of the tenant that hosts the duplo service.

### Optional

- `timeouts` (Block, Optional) (see [below for nested schema](#nestedblock--timeouts))
- `wait_until_ready` (Boolean) Whether or not to wait until Duplo considers all of the load balancers ready Defaults to `true`.

### Read-Only

- `arn` (String) The load balancer ARN.
- `id` (String) The ID of this resource.
- `status` (String) The load balancer's current status.

<a id="nestedblock--lbconfigs"></a>
### Nested Schema for `lbconfigs`

Required:

- `lb_type` (Number) The numerical index of the type of load balancer configuration to create.
Should be one of:

   - `0` : ELB (Classic Load Balancer)
   - `1` : ALB (Application Load Balancer)
   - `2` : Health-check Only (No Load Balancer)
   - `3` : K8S Service w/ Cluster IP (No Load Balancer)
   - `4` : K8S Service w/ Node Port (No Load Balancer)
   - `5` : Azure Shared Application Gateway
   - `6` : NLB (Network Load Balancer)
   - `7` : Target Group Only
- `port` (String) The backend port associated with this load balancer configuration.
- `protocol` (String) The backend protocol associated with this load balancer configuration.
Supported protocol based on lb_type:

`0 (ELB)`: HTTP, HTTPS, TCP, UDP
`1 (ALB)` : HTTP, HTTPS
`3 (K8S Service w/ Cluster IP)`: TCP, UDP
`4 (K8S Service w/ Node Port)` : TCP, UDP
`5 (Azure Shared Application Gateway)`: HTTP, HTTPS
`6 (NLB)` : TCP, UDP, TLS
`7 (Target Group Only)` : HTTP, HTTPS

Optional:

- `allow_global_access` (Boolean) Applicable for internal lb.
- `backend_protocol_version` (String) Is used for communication between the load balancer and the target instances. This is a required field for ALB load balancer. Only applicable when protocol is HTTP or HTTPS. The protocol version. Specify GRPC to send requests to targets using gRPC. Specify HTTP2 to send requests to targets using HTTP/2. The default is HTTP1, which sends requests to targets using HTTP/1.1 Defaults to `HTTP1`.
- `certificate_arn` (String) The ARN of an ACM certificate to associate with this load balancer.  Only applicable for HTTPS.
- `custom_cidr` (List of String) Specify CIDR Values. This is applicable only for Network Load Balancer if `lb_type` is `6`.
- `external_port` (Number) The frontend port associated with this load balancer configuration. Required if `lb_type` is not `7`.
- `external_traffic_policy` (String) Only for K8S Node Port (`lb_type = 4`) or load balancers in Kubernetes.  Set the kubernetes service `externalTrafficPolicy` attribute.
- `extra_selector_label` (Block List) Only for K8S services or load balancers in Kubernetes.  Sets an additional selector label to narrow which pods can receive traffic. (see [below for nested schema](#nestedblock--lbconfigs--extra_selector_label))
- `health_check` (Block List, Max: 1) Health Check configuration block. (see [below for nested schema](#nestedblock--lbconfigs--health_check))
- `health_check_url` (String) The health check URL to associate with this load balancer configuration.
- `host_name` (String) (Azure Only) Set only if Azure Shared Application Gateway is used (`lb_type = 5`).
- `is_internal` (Boolean) Whether or not to create an internal load balancer.
- `is_native` (Boolean) Set to true if the service for which the load balancer is being created is hosted on a docker native host, which is managed directly by DuploCloud, or false if the service is hosted on a cloud-provided platform like EKS, AKS, GKE, ECS, etc. The `duplocloud_native_hosts` data source lists the native hosts in a DuploCloud Tenant
- `set_ingress_health_check` (Boolean) Only for K8S services or load balancers in Kubernetes.  Set to `true` to set health check annotations for ingress.
- `skip_http_to_https` (Boolean) Skip http to https.

Read-Only:

- `cloud_name` (String) The name of the cloud load balancer (if applicable).
- `dns_name` (String) The DNS name of the cloud load balancer (if applicable).
- `frontend_ip` (String)
- `host_port` (Number) The automatically assigned host port.
- `index` (Number) The load balancer Index.
- `is_infra_deployment` (Boolean)
- `name` (String) The name of the duplo service.
- `replication_controller_name` (String) The name of the duplo service.
- `target_group_arn` (String) The ARN of the Target Group to which to route traffic.

<a id="nestedblock--lbconfigs--extra_selector_label"></a>
### Nested Schema for `lbconfigs.extra_selector_label`

Required:

- `key` (String)
- `value` (String)


<a id="nestedblock--lbconfigs--health_check"></a>
### Nested Schema for `lbconfigs.health_check`

Optional:

- `grpc_success_codes` (String) Response codes to use when checking for a healthy responses from a target. You can specify multiple values (for example, "0,12" for GRPC) or a range of values (for example, "0-99"). Required for GRPC ALB. Only applies to Application Load Balancers (i.e., GRPC) not Network Load Balancers (i.e., TCP).
- `healthy_threshold` (Number) Number of consecutive health checks successes required before considering an unhealthy target healthy. Defaults to `3`.
- `http_success_codes` (String) Response codes to use when checking for a healthy responses from a target. You can specify multiple values (for example, "200,202" for HTTP(s)) or a range of values (for example, "200-299"). Required for HTTP/HTTPS ALB. Only applies to Application Load Balancers (i.e., HTTP/HTTPS) not Network Load Balancers (i.e., TCP).
- `interval` (Number) Approximate amount of time, in seconds, between health checks of an individual target. Minimum value 5 seconds, Maximum value 300 seconds. Defaults to `30`.
- `timeout` (Number) Amount of time, in seconds, during which no response means a failed health check.
- `unhealthy_threshold` (Number) Number of consecutive health check failures required before considering the target unhealthy. Defaults to `3`.



<a id="nestedblock--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String)
- `delete` (String)
- `update` (String)

## Import

Import is supported using the following syntax:

```shell
# Example: Importing an existing service's load balancer configurations
#  - *TENANT_ID* is the tenant GUID
#  - *NAME* is the name of the service
#
terraform import duplocloud_duplo_service_lbconfigs.myservice v2/subscriptions/*TENANT_ID*/ServiceLBConfigsV2/*NAME*
```
