---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "duplocloud_gcp_pubsub_subscription Resource - terraform-provider-duplocloud"
subcategory: ""
description: |-
  
---

# duplocloud_gcp_pubsub_subscription (Resource)



## Example Usage

```terraform
resource "duplocloud_tenant" "myapp" {
  account_name = "myapp"
  plan_id      = "default"
}

//example for push config
resource "duplocloud_gcp_pubsub_subscription" "sub" {
  tenant_id            = duplocloud_tenant.myapp.tenant_id
  name                 = "subtest6"
  topic                = "test-topic1"
  ack_deadline_seconds = 20

  labels = {
    foo = "bar"
  }

  push_config {
    push_endpoint = "https://example.com/push"

    attributes = {
      x-goog-version = "v1"
    }
  }
}


//example for pull
resource "duplocloud_gcp_pubsub_subscription" "pullsub" {
  tenant_id = duplocloud_tenant.myapp.tenant_id
  name      = "subtest8"
  topic     = "test-topic1"

  labels = {
    foo = "bar"
  }

  # 20 minutes
  message_retention_duration = "1200s"
  retain_acked_messages      = true

  ack_deadline_seconds = 20

  expiration_policy {
    ttl = "300000.5s"
  }
  retry_policy {
    minimum_backoff = "10s"
  }

  enable_message_ordering = false
}

//example Deadletter policy
resource "duplocloud_gcp_pubsub_subscription" "pullsub" {
  tenant_id = duplocloud_tenant.myapp.tenant_id
  name      = "subtest9"
  topic     = "test-topic1"

  dead_letter_policy {
    dead_letter_topic     = "projects/<project-identifier>/topics/<topic-name>"
    max_delivery_attempts = 10
  }
}


//example BigQuery
resource "duplocloud_gcp_pubsub_subscription" "sub" {
  tenant_id = duplocloud_tenant.myapp.tenant_id
  name      = "subtest12"
  topic     = "test-topic1"
  big_query {
    table                 = "{project}.{dataset}.{table}"
    service_account_email = "abc@xxyz.com"
    use_table_schema      = true
  }
}

//example cloud storage
resource "duplocloud_gcp_pubsub_subscription" "pullsub" {
  tenant_id = duplocloud_tenant.myapp.tenant_id
  name      = "subtestcloud"
  topic     = "test-topic1"

  cloud_storage_config {
    bucket = "{cloudstorage-bucketnamr}"

    filename_prefix          = "pre-"
    filename_suffix          = "10"
    filename_datetime_format = "YYYY-MM-DD/hh_mm_ssZ"

    max_bytes    = 1000
    max_duration = "300s"
    max_messages = 1000
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `name` (String) Name of the subscription.
- `tenant_id` (String) The GUID of the tenant that the storage bucket will be created in.
- `topic` (String) A reference to a Topic resource.

### Optional

- `ack_deadline_seconds` (Number) This value is the maximum time after a subscriber receives a message before the subscriber should acknowledge the message. Defaults to `10`.
- `big_query` (Block List, Max: 1) Default encryption settings for objects uploaded to the bucket. (see [below for nested schema](#nestedblock--big_query))
- `cloud_storage_config` (Block List, Max: 1) Default encryption settings for objects uploaded to the bucket. (see [below for nested schema](#nestedblock--cloud_storage_config))
- `dead_letter_policy` (Block List, Max: 1) A policy that specifies the conditions for dead lettering messages in this subscription. If dead_letter_policy is not set, dead lettering is disabled (see [below for nested schema](#nestedblock--dead_letter_policy))
- `enable_exactly_once_delivery` (Boolean) If true, Pub/Sub provides the following guarantees for the delivery of a message with a given value of messageId on this Subscriptions': * The message sent to a subscriber is guaranteed not to be resent before the message's acknowledgement deadline expires. * An acknowledged message will not be resent to a subscriber. Note that subscribers may still receive multiple copies of a message when enable_exactly_once_delivery is true if the message was published multiple times by a publisher client. These copies are considered distinct by Pub/Sub and have distinct messageId values Defaults to `false`.
- `enable_message_ordering` (Boolean) If true, messages published with the same orderingKey in PubsubMessage will be delivered to the subscribers in the order in which they are received by the Pub/Sub system. Otherwise, they may be delivered in any order. Defaults to `false`.
- `expiration_policy` (Block List, Max: 1) A policy that specifies the conditions for this subscription's expiration. A subscription is considered active as long as any connected subscriber is successfully consuming messages from the subscription or is issuing operations on the subscription (see [below for nested schema](#nestedblock--expiration_policy))
- `filter` (String) The subscription only delivers the messages that match the filter. Pub/Sub automatically acknowledges the messages that don't match the filter. You can filter messages by their attributes. The maximum length of a filter is 256 bytes. After creating the subscription, you can't modify the filter.
- `labels` (Map of String) A set of key/value label pairs to assign to this Subscription
- `message_retention_duration` (String) How long to retain unacknowledged messages in the subscription's backlog, from the moment a message is published. If retain_acked_messages is true, then this also configures the retention of acknowledged messages, and thus configures how far back in time a subscriptions.seek can be done. Defaults to 7 days. Cannot be more than 7 days. Defaults to `604800s`.
- `push_config` (Block List, Max: 1) Default encryption settings for objects uploaded to the bucket. (see [below for nested schema](#nestedblock--push_config))
- `retain_acked_messages` (Boolean) Indicates whether to retain acknowledged messages. Defaults to `false`.
- `retry_policy` (Block List, Max: 1) A policy that specifies how Pub/Sub retries message delivery for this subscription. If not set, the default retry policy is applied. This generally implies that messages will be retried as soon as possible for healthy subscribers. RetryPolicy will be triggered on NACKs or acknowledgement deadline exceeded events for a given message (see [below for nested schema](#nestedblock--retry_policy))
- `timeouts` (Block, Optional) (see [below for nested schema](#nestedblock--timeouts))

### Read-Only

- `id` (String) The ID of this resource.

<a id="nestedblock--big_query"></a>
### Nested Schema for `big_query`

Required:

- `table` (String) The name of the table to which to write data.

Optional:

- `drop_unknown_fields` (Boolean) When true and use_topic_schema or use_table_schema is true, any fields that are a part of the topic schema or message schema that are not part of the BigQuery table schema are dropped when writing to BigQuery. Otherwise, the schemas must be kept in sync and any messages with extra fields are not written and remain in the subscription's backlog Defaults to `false`.
- `service_account_email` (String) The service account to use to write to BigQuery. If not specified, the Pub/Sub service agent, service-{project_number}@gcp-sa-pubsub.iam.gserviceaccount.com, is used.
- `use_table_schema` (Boolean) When true, write the subscription name, messageId, publishTime, attributes, and orderingKey to additional columns in the table. Defaults to `false`.
- `use_topic_schema` (Boolean) When true, use the topic's schema as the columns to write to in BigQuery, if it exists. Only one of use_topic_schema and use_table_schema can be set. Defaults to `false`.
- `write_metadata` (Boolean) When true, write the subscription name, messageId, publishTime, attributes, and orderingKey as additional fields in the output. Defaults to `false`.

Read-Only:

- `state` (String) An output-only field that indicates whether or not the subscription can receive messages.


<a id="nestedblock--cloud_storage_config"></a>
### Nested Schema for `cloud_storage_config`

Required:

- `bucket` (String) User-provided name for the Cloud Storage bucket. The bucket must be created by the user. The bucket name must be without any prefix like 'gs://'.

Optional:

- `avro_config` (Block List, Max: 1) (see [below for nested schema](#nestedblock--cloud_storage_config--avro_config))
- `filename_datetime_format` (String) User-provided format string specifying how to represent datetimes in Cloud Storage filenames
- `filename_prefix` (String) User-provided prefix for Cloud Storage filename.
- `filename_suffix` (String) User-provided suffix for Cloud Storage filename. Must not end in '/'.
- `max_bytes` (Number) The maximum bytes that can be written to a Cloud Storage file before a new file is created. Min 1 KB, max 10 GiB. The maxBytes limit may be exceeded in cases where messages are larger than the limit.
- `max_duration` (String) The maximum duration that can elapse before a new Cloud Storage file is created. Min 1 minute, max 10 minutes, default 5 minutes. May not exceed the subscription's acknowledgement deadline Defaults to `300s`.
- `max_messages` (Number) The maximum messages that can be written to a Cloud Storage file before a new file is created. Min 1000 messages. Defaults to `1000`.
- `service_account_email` (String) The service account to use to write to BigQuery. If not specified, the Pub/Sub service agent, service-{project_number}@gcp-sa-pubsub.iam.gserviceaccount.com, is used.

Read-Only:

- `state` (String) An output-only field that indicates whether or not the subscription can receive messages.

<a id="nestedblock--cloud_storage_config--avro_config"></a>
### Nested Schema for `cloud_storage_config.avro_config`

Optional:

- `use_topic_schema` (Boolean) When true, the output Cloud Storage file will be serialized using the topic schema, if it exists. Defaults to `false`.
- `write_metadata` (Boolean) When true, write the subscription name, messageId, publishTime, attributes, and orderingKey as additional fields in the output. Defaults to `false`.



<a id="nestedblock--dead_letter_policy"></a>
### Nested Schema for `dead_letter_policy`

Optional:

- `dead_letter_topic` (String) The name of the topic to which dead letter messages should be published.
- `max_delivery_attempts` (Number) The maximum number of delivery attempts for any message. The value must be between 5 and 100. The number of delivery attempts is defined as 1 + (the sum of number of NACKs and number of times the acknowledgement deadline has been exceeded for the message) Defaults to `5`.


<a id="nestedblock--expiration_policy"></a>
### Nested Schema for `expiration_policy`

Required:

- `ttl` (String) Specifies the 'time-to-live' duration for an associated resource. The resource expires if it is not active for a period of ttl. If ttl is empty string, the associated resource never expires.  A duration in seconds with up to nine fractional digits, terminated by 's'. Example - '3.5s'.


<a id="nestedblock--push_config"></a>
### Nested Schema for `push_config`

Required:

- `push_endpoint` (String) User-provided name for the Cloud Storage bucket. The bucket must be created by the user. The bucket name must be without any prefix like 'gs://'.

Optional:

- `attributes` (Map of String)
- `no_wrapper` (Block List, Max: 1) When set, the payload to the push endpoint is not wrapped (see [below for nested schema](#nestedblock--push_config--no_wrapper))
- `oidc_token` (Block List, Max: 1) (see [below for nested schema](#nestedblock--push_config--oidc_token))

<a id="nestedblock--push_config--no_wrapper"></a>
### Nested Schema for `push_config.no_wrapper`

Required:

- `write_metadata` (Boolean) When true, writes the Pub/Sub message metadata to x-goog-pubsub-<KEY>:<VAL> headers of the HTTP request. Writes the Pub/Sub message attributes to <KEY>:<VAL> headers of the HTTP request.


<a id="nestedblock--push_config--oidc_token"></a>
### Nested Schema for `push_config.oidc_token`

Required:

- `service_account_email` (String) Service account email to be used for generating the OIDC token.

Optional:

- `audience` (String) Audience to be used when generating OIDC token. The audience claim identifies the recipients that the JWT is intended for. The audience value is a single case-sensitive string. Defaults to `false`.



<a id="nestedblock--retry_policy"></a>
### Nested Schema for `retry_policy`

Optional:

- `maximum_backoff` (String) The maximum delay between consecutive deliveries of a given message. Value should be between 0 and 600 seconds. Defaults to 600 seconds. Defaults to `600s`.
- `minimum_backoff` (String) The minimum delay between consecutive deliveries of a given message. Value should be between 0 and 600 seconds. Defaults to 10 seconds Defaults to `10s`.


<a id="nestedblock--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String)
- `delete` (String)

## Import

Import is supported using the following syntax:

```shell
# Example: Importing an existing GCP storage bucket
#  - *TENANT_ID* is the tenant GUID
#  - *SHORT_NAME* is the short name of the GCP storage bucket
#
terraform import duplocloud_gcp_storage_bucket.mybucket *TENANT_ID*/*SHORT_NAME*
```
