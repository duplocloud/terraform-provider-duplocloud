---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "duplocloud_aws_lb_listener_rule Resource - terraform-provider-duplocloud"
subcategory: ""
description: |-
  duplocloud_aws_lb_listener_rule manages an AWS Listener Rule in Duplo.
---

# duplocloud_aws_lb_listener_rule (Resource)

`duplocloud_aws_lb_listener_rule` manages an AWS Listener Rule in Duplo.

## Example Usage

```terraform
locals {
  tenant_id = "053a2efa-d03f-4e1d-b3b5-33c04cbed87e"
  vpc_id    = "vpc-0ba0667cfc200f060"
  cert_arn  = "arn:aws:acm:us-west-2:957282632678:certificate/2e882320-5aa5-4b8d-881f-998050178205"
}

resource "duplocloud_aws_load_balancer" "alb" {
  tenant_id            = local.tenant_id
  name                 = "tst-alb"
  is_internal          = true
  enable_access_logs   = true
  drop_invalid_headers = true
}

resource "duplocloud_aws_lb_target_group" "tg" {
  tenant_id   = local.tenant_id
  name        = "tg1"
  port        = 80
  protocol    = "HTTP"
  vpc_id      = local.vpc_id
  target_type = "instance"
}

resource "duplocloud_aws_load_balancer_listener" "alb-listener" {
  tenant_id          = local.tenant_id
  load_balancer_name = duplocloud_aws_load_balancer.alb.name
  port               = 8443
  protocol           = "HTTPS"
  target_group_arn   = duplocloud_aws_lb_target_group.tg.arn
  certificate_arn    = local.cert_arn
}

resource "duplocloud_aws_lb_listener_rule" "static" {
  tenant_id    = local.tenant_id
  listener_arn = duplocloud_aws_load_balancer_listener.alb-listener.arn
  priority     = 100

  action {
    type             = "forward"
    target_group_arn = duplocloud_aws_lb_target_group.tg.arn
  }

  condition {
    path_pattern {
      values = ["/static/*"]
    }
  }

  condition {
    host_header {
      values = ["example.com"]
    }
  }
}

# Forward action

resource "duplocloud_aws_lb_listener_rule" "host_based_weighted_routing" {
  tenant_id    = local.tenant_id
  listener_arn = duplocloud_aws_load_balancer_listener.alb-listener.arn
  priority     = 99

  action {
    type             = "forward"
    target_group_arn = duplocloud_aws_lb_target_group.tg.arn
  }

  condition {
    host_header {
      values = ["my-service.*.terraform.io"]
    }
  }
}

# Redirect action

resource "duplocloud_aws_lb_listener_rule" "redirect_http_to_https" {
  tenant_id    = local.tenant_id
  listener_arn = duplocloud_aws_load_balancer_listener.alb-listener.arn
  priority     = 98
  action {
    type = "redirect"

    redirect {
      port        = "443"
      protocol    = "HTTPS"
      status_code = "HTTP_301"
    }
  }

  condition {
    http_header {
      http_header_name = "X-Forwarded-For"
      values           = ["192.168.1.*"]
    }
  }
}

# Fixed-response action

resource "duplocloud_aws_lb_listener_rule" "health_check" {
  tenant_id    = local.tenant_id
  listener_arn = duplocloud_aws_load_balancer_listener.alb-listener.arn
  priority     = 97
  action {
    type = "fixed-response"

    fixed_response {
      content_type = "text/plain"
      message_body = "HEALTHY"
      status_code  = "200"
    }
  }

  condition {
    query_string {
      key   = "health"
      value = "check"
    }

    query_string {
      key   = "foo"
      value = "bar"
    }
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `action` (Block List, Min: 1) (see [below for nested schema](#nestedblock--action))
- `condition` (Block Set, Min: 1) A Condition block. Multiple condition blocks of different types can be set and all must be satisfied for the rule to match. (see [below for nested schema](#nestedblock--condition))
- `listener_arn` (String) The ARN of the listener to which to attach the rule.
- `tenant_id` (String) The GUID of the tenant that the aws lb listener rule will be created in.

### Optional

- `priority` (Number) The priority for the rule between `1` and `50000`. Leaving it unset will automatically set the rule with next available priority after currently existing highest rule. A listener can't have multiple rules with the same priority.
- `tags` (Block List) (see [below for nested schema](#nestedblock--tags))
- `timeouts` (Block, Optional) (see [below for nested schema](#nestedblock--timeouts))

### Read-Only

- `arn` (String) The ARN of the rule.
- `id` (String) The ID of this resource.

<a id="nestedblock--action"></a>
### Nested Schema for `action`

Required:

- `type` (String) The type of routing action. Valid values are `redirect`, `forward`, `fixed-response`, `authenticate-cognito` and `authenticate-oidc`

Optional:

- `authenticate_cognito` (Block List, Max: 1) Information for creating an authenticate action using Cognito. Required if `type` is `authenticate-cognito`. (see [below for nested schema](#nestedblock--action--authenticate_cognito))
- `authenticate_oidc` (Block List, Max: 1) Information for creating an authenticate action using OIDC. Required if `type` is `authenticate-oidc`. (see [below for nested schema](#nestedblock--action--authenticate_oidc))
- `fixed_response` (Block List, Max: 1) Information for creating an action that returns a custom HTTP response. Required if `type` is `fixed-response`. (see [below for nested schema](#nestedblock--action--fixed_response))
- `forward` (Block List, Max: 1) Information for creating an action that distributes requests among one or more target groups. Specify only if `type` is `forward`. If you specify both `forward` block and `target_group_arn` attribute, you can specify only one target group. (see [below for nested schema](#nestedblock--action--forward))
- `order` (Number)
- `redirect` (Block List, Max: 1) Information for creating a redirect action. Required if `type` is `redirect`. (see [below for nested schema](#nestedblock--action--redirect))
- `target_group_arn` (String) The ARN of the Target Group to which to route traffic. Specify only if `type` is `forward` and you want to route to a single target group. To route to one or more target groups, use a `forward` block instead.

<a id="nestedblock--action--authenticate_cognito"></a>
### Nested Schema for `action.authenticate_cognito`

Required:

- `user_pool_arn` (String) The ARN of the Cognito user pool.
- `user_pool_client_id` (String) The ID of the Cognito user pool client.
- `user_pool_domain` (String) The domain prefix or fully-qualified domain name of the Cognito user pool.

Optional:

- `authentication_request_extra_params` (Map of String) The query parameters to include in the redirect request to the authorization endpoint.
- `on_unauthenticated_request` (String) The behavior if the user is not authenticated. Valid values: `deny`, `allow` and `authenticate`.
- `scope` (String) The set of user claims to be requested from the IdP. Defaults to `openid`.
- `session_cookie_name` (String) The name of the cookie used to maintain session information. Defaults to `AWSELBAuthSessionCookie`.
- `session_timeout` (Number) The maximum duration of the authentication session, in seconds. Defaults to `604800`.


<a id="nestedblock--action--authenticate_oidc"></a>
### Nested Schema for `action.authenticate_oidc`

Required:

- `authorization_endpoint` (String) The authorization endpoint of the IdP.
- `client_id` (String) The OAuth 2.0 client identifier.
- `client_secret` (String, Sensitive) The OAuth 2.0 client secret.
- `issuer` (String) The OIDC issuer identifier of the IdP.
- `token_endpoint` (String) The token endpoint of the IdP.
- `user_info_endpoint` (String) The user info endpoint of the IdP.

Optional:

- `authentication_request_extra_params` (Map of String) The query parameters to include in the redirect request to the authorization endpoint. Max: 10
- `on_unauthenticated_request` (String) The behavior if the user is not authenticated. Valid values: `deny`, `allow` and `authenticate`.
- `scope` (String) The set of user claims to be requested from the IdP. Defaults to `openid`.
- `session_cookie_name` (String) The name of the cookie used to maintain session information. Defaults to `AWSELBAuthSessionCookie`.
- `session_timeout` (Number) The maximum duration of the authentication session, in seconds. Defaults to `604800`.


<a id="nestedblock--action--fixed_response"></a>
### Nested Schema for `action.fixed_response`

Required:

- `content_type` (String) The content type. Valid values are `text/plain`, `text/css`, `text/html`, `application/javascript` and `application/json`

Optional:

- `message_body` (String) The message body.
- `status_code` (String) The HTTP response code. Valid values are `2XX`, `4XX`, or `5XX`.


<a id="nestedblock--action--forward"></a>
### Nested Schema for `action.forward`

Required:

- `target_group` (Block Set, Min: 2, Max: 5) (see [below for nested schema](#nestedblock--action--forward--target_group))

Optional:

- `stickiness` (Block List, Max: 1) (see [below for nested schema](#nestedblock--action--forward--stickiness))

<a id="nestedblock--action--forward--target_group"></a>
### Nested Schema for `action.forward.target_group`

Required:

- `arn` (String) The Amazon Resource Name (ARN) of the target group.

Optional:

- `weight` (Number) The weight. The range is 0 to 999. Defaults to `1`.


<a id="nestedblock--action--forward--stickiness"></a>
### Nested Schema for `action.forward.stickiness`

Required:

- `duration` (Number) The time period, in seconds, during which requests from a client should be routed to the same target group.

Optional:

- `enabled` (Boolean) Indicates whether target group stickiness is enabled. Defaults to `false`.



<a id="nestedblock--action--redirect"></a>
### Nested Schema for `action.redirect`

Required:

- `status_code` (String) The HTTP redirect code. The redirect is either permanent or temporary

Optional:

- `host` (String) The hostname. This component is not percent-encoded. The hostname can contain `#{host}`. Defaults to `#{host}`.
- `path` (String) The absolute path, starting with the leading "/". Defaults to `/#{path}`.
- `port` (String) The port. Specify a value from `1` to `65535`. Defaults to `#{port}`.
- `protocol` (String) The protocol. Valid values are `HTTP`, `HTTPS`, or `#{protocol}`. Defaults to `#{protocol}`.
- `query` (String) The query parameters, URL-encoded when necessary. Defaults to `#{query}`.



<a id="nestedblock--condition"></a>
### Nested Schema for `condition`

Optional:

- `host_header` (Block List, Max: 1) (see [below for nested schema](#nestedblock--condition--host_header))
- `http_header` (Block List, Max: 1) HTTP headers to match. (see [below for nested schema](#nestedblock--condition--http_header))
- `http_request_method` (Block List, Max: 1) Contains a single `values` item which is a list of HTTP request methods or verbs to match. Maximum size is 40 characters. (see [below for nested schema](#nestedblock--condition--http_request_method))
- `path_pattern` (Block List, Max: 1) Contains a single `values` item which is a list of path patterns to match against the request URL. Maximum size of each pattern is 128 characters. (see [below for nested schema](#nestedblock--condition--path_pattern))
- `query_string` (Block Set) Query strings to match. (see [below for nested schema](#nestedblock--condition--query_string))
- `source_ip` (Block List, Max: 1) Contains a single `values` item which is a list of source IP CIDR notations to match. (see [below for nested schema](#nestedblock--condition--source_ip))

<a id="nestedblock--condition--host_header"></a>
### Nested Schema for `condition.host_header`

Required:

- `values` (Set of String) Contains a single `values` item which is a list of host header patterns to match. The maximum size of each pattern is 128 characters.


<a id="nestedblock--condition--http_header"></a>
### Nested Schema for `condition.http_header`

Required:

- `http_header_name` (String) Name of HTTP header to search. The maximum size is 40 characters.
- `values` (Set of String) List of header value patterns to match. Maximum size of each pattern is 128 characters.


<a id="nestedblock--condition--http_request_method"></a>
### Nested Schema for `condition.http_request_method`

Required:

- `values` (Set of String)


<a id="nestedblock--condition--path_pattern"></a>
### Nested Schema for `condition.path_pattern`

Required:

- `values` (Set of String)


<a id="nestedblock--condition--query_string"></a>
### Nested Schema for `condition.query_string`

Required:

- `value` (String) Query string value pattern to match.

Optional:

- `key` (String) Query string key pattern to match.


<a id="nestedblock--condition--source_ip"></a>
### Nested Schema for `condition.source_ip`

Required:

- `values` (Set of String)



<a id="nestedblock--tags"></a>
### Nested Schema for `tags`

Required:

- `key` (String)
- `value` (String)


<a id="nestedblock--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String)
- `delete` (String)

## Import

Import is supported using the following syntax:

```shell
# Example: Importing an existing AWS AWS LB Listener Rule
#  - *TENANT_ID* is the tenant GUID
#  - *RULE_ARN* is the ARN of the AWS LB Listener Rule
#
terraform import duplocloud_aws_lb_listener_rule.listener_rule *TENANT_ID*/*RULE_ARN*
```
