---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "duplocloud_k8_ingress Resource - terraform-provider-duplocloud"
subcategory: ""
description: |-
  duplocloud_k8_ingress manages a kubernetes Ingress in a Duplo tenant.
---

# duplocloud_k8_ingress (Resource)

`duplocloud_k8_ingress` manages a kubernetes Ingress in a Duplo tenant.

## Example Usage

```terraform
resource "duplocloud_tenant" "myapp" {
  account_name = "myapp"
  plan_id      = "default"
}

// Example 1:
//
// - Two services in duplocloud (`echo` and `echo2`)
// - Both of the above services configured as kubernetes services of type `NodePort`
// - Both of the services exposed as a kubernetes ingress
//
resource "duplocloud_duplo_service" "echo" {
  tenant_id                            = duplocloud_tenant.myapp.tenant_id
  name                                 = "echo"
  replicas                             = 1
  lb_synced_deployment                 = false
  cloud_creds_from_k8s_service_account = true
  is_daemonset                         = false
  agent_platform                       = 7
  cloud                                = 0
  other_docker_config = jsonencode({
    "Args" : [
      "-text=\"Hello world\""
    ]
    }
  )
  docker_image = "hashicorp/http-echo:latest"
}

resource "duplocloud_duplo_service_lbconfigs" "echo_config" {
  tenant_id                   = duplocloud_duplo_service.echo.tenant_id
  replication_controller_name = duplocloud_duplo_service.echo.name
  lbconfigs {
    lb_type          = 4
    is_native        = false
    is_internal      = false
    port             = 5678
    external_port    = 30001
    protocol         = "tcp"
    health_check_url = "/"
  }
}

resource "duplocloud_duplo_service" "echo2" {
  tenant_id                            = duplocloud_tenant.myapp.tenant_id
  name                                 = "echo2"
  replicas                             = 1
  lb_synced_deployment                 = false
  cloud_creds_from_k8s_service_account = true
  is_daemonset                         = false
  agent_platform                       = 7
  cloud                                = 0
  other_docker_config = jsonencode({
    "Args" : [
      "-text=\"Hello India\""
    ]
    }
  )
  docker_image = "hashicorp/http-echo:latest"
}

resource "duplocloud_duplo_service_lbconfigs" "echo2_config" {
  tenant_id                   = duplocloud_duplo_service.echo2.tenant_id
  replication_controller_name = duplocloud_duplo_service.echo2.name
  lbconfigs {
    lb_type          = 4
    is_native        = false
    is_internal      = false
    port             = 5678
    external_port    = 30002
    protocol         = "tcp"
    health_check_url = "/"
  }
}


resource "time_sleep" "wait_45_seconds" {
  depends_on = [duplocloud_duplo_service.echo, duplocloud_duplo_service.echo2]

  create_duration = "45s"
}

resource "duplocloud_k8_ingress" "ingress" {
  tenant_id          = duplocloud_tenant.myapp.tenant_id
  name               = "external-echo"
  ingress_class_name = "alb"
  lbconfig {
    is_internal     = false
    dns_prefix      = "external-echo"
    certificate_arn = "put your certificate ARN here"
    https_port      = 443
  }

  rule {
    path         = "/hello-world"
    path_type    = "Prefix"
    service_name = duplocloud_duplo_service.echo.name
    port         = 5678
  }
  rule {
    path         = "/hello-india"
    path_type    = "Prefix"
    service_name = duplocloud_duplo_service.echo2.name
    port         = 5678
  }

  depends_on = [time_sleep.wait_45_seconds]
}



// Example 2:
//
// - Adding a custom redirect to an ingress resource
//
resource "duplocloud_k8_ingress" "ingress" {
  tenant_id          = duplocloud_tenant.myapp.tenant_id
  name               = "joedemo"
  ingress_class_name = "alb"

  annotations = {
    "alb.ingress.kubernetes.io/actions.redirect-to-new-domain" = jsonencode({
      Type = "redirect",
      RedirectConfig = {
        Host       = "my.example.com",
        Path       = "/#{path}",
        Port       = "#{port}",
        Protocol   = "HTTPS",
        Query      = "#{query}",
        StatusCode = "HTTP_301"
      }
    })
  }

  lbconfig {
    is_internal = false
    dns_prefix  = "joedemo-ingress"
    http_port   = 80
  }

  rule {
    path         = "/"
    path_type    = "Prefix"
    service_name = "redirect-to-new-domain"
    port_name    = "use-annotation"
  }
}

//example for tls
resource "duplocloud_k8_ingress" "ingress" {
  tenant_id          = duplocloud_tenant.myapp.tenant_id
  name               = "external-echo"
  ingress_class_name = "alb"
  lbconfig {
    is_internal     = false
    dns_prefix      = "external-echo"
    certificate_arn = "put your certificate ARN here"
    https_port      = 443
  }

  rule {
    path         = "/hello-world"
    path_type    = "Prefix"
    service_name = duplocloud_duplo_service.echo.name
    port         = 5678
  }

  tls {
    secret_name = "tlssecret"
    hosts       = ["example.com", "https-example.foo.com", "abc.com"]
  }
  depends_on = [time_sleep.wait_45_seconds]

}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `ingress_class_name` (String) The ingress class name references an IngressClass resource that contains additional configuration including the name of the controller that should implement the class.
- `name` (String) The name of the Ingress.
- `tenant_id` (String) The GUID of the tenant that the Ingress will be created in.

### Optional

- `annotations` (Map of String) An unstructured key value map stored with the ingress that may be used to store arbitrary metadata.
- `labels` (Map of String) Map of string keys and values that can be used to organize and categorize (scope and select) the service. May match selectors of replication controllers and services.
- `lbconfig` (Block List, Max: 1) The load balancer configuration. This is required when `ingress_class_name` is set to `alb`. (see [below for nested schema](#nestedblock--lbconfig))
- `rule` (Block List) A list of host rules used to configure the Ingress. (see [below for nested schema](#nestedblock--rule))
- `timeouts` (Block, Optional) (see [below for nested schema](#nestedblock--timeouts))
- `tls` (Block List) Block represents the TLS configuration. Currently the Ingress only supports a single TLS port, 443. If multiple members of this list specify different hosts, they will be multiplexed on the same port according to the hostname specified through the SNI TLS extension, if the ingress controller fulfilling the ingress supports SNI (see [below for nested schema](#nestedblock--tls))

### Read-Only

- `id` (String) The ID of this resource.

<a id="nestedblock--lbconfig"></a>
### Nested Schema for `lbconfig`

Required:

- `dns_prefix` (String) The DNS prefix to expose services using Route53 domain.
- `is_internal` (Boolean) Whether or not to create an internal load balancer.

Optional:

- `certificate_arn` (String) The ARN of an ACM certificate to associate with this load balancer.  Only applicable for HTTPS.
- `http_port` (Number) HTTP Listener Port.
- `https_port` (Number) HTTPS Listener Port.


<a id="nestedblock--rule"></a>
### Nested Schema for `rule`

Required:

- `path` (String) Specify the path (for e.g. /api /v1/api/) to do a path base routing. If host is specified then both path and host should be match for the incoming request.
- `path_type` (String) Type of the path to be used.
- `service_name` (String) Name of the kubernetes service which Ingress will use as backend to serve the request.

Optional:

- `host` (String) If a host is provided (for e.g. example, foo.bar.com), the rules apply to that host.
- `port` (Number) Port from the kubernetes service that ingress will use as backend port to serve the requests.
- `port_name` (String) Port name from the kubernetes service that ingress will use as backend port to serve the requests.


<a id="nestedblock--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String)
- `delete` (String)
- `update` (String)


<a id="nestedblock--tls"></a>
### Nested Schema for `tls`

Required:

- `hosts` (List of String) The list of hosts included in the TLS certificate. Each value in this list must match the name(s) specified in the TLS secret. If not specified, it defaults to the wildcard host setting for the load balancer controller managing this Ingress.
- `secret_name` (String) The name of the secret used to terminate TLS traffic on port 443. This field is optional, enabling TLS routing based solely on the SNI hostname. If the SNI host in a listener conflicts with the 'Host' header in an IngressRule, the SNI host is used for termination, while the 'Host' header value is used for routing.

## Import

Import is supported using the following syntax:

```shell
# Example: Importing an existing kubernetes ingress
#  - *TENANT_ID* is the tenant GUID
#  - *NAME* is the ingress name
#
terraform import duplocloud_k8_ingress.ingress v3/subscriptions/*TENANT_ID*/k8s/ingress/*NAME*
```
